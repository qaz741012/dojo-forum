<div>
  <div class="post-title mb-3 p-3">
    <h2 class="d-inline-block"><%= @post.title %></h2>
    <div class="d-inline-block float-right">
      <% if current_user.collected_post?(@post) %>
        <%= link_to "Uncollect", uncollect_post_path(@post), method: :post,
        class: "btn btn-secondary" %>
      <% else %>
        <%= link_to "Collect", collect_post_path(@post), method: :post,
        class: "btn btn-secondary" %>
      <% end %>
      <%= link_to "Comment", "#comment-area", class: "btn btn-secondary" %>
      <span class="badge badge-warning"><%= "draft: " + @post.draft?.to_s %></span>
    </div>
    <div>
      <% @categories.each do |category| %>
        <span class="badge badge-secondary"><%= category.name %></span>
      <% end %>
    </div>
  </div>
  <div class="row mt-5 mx-4">
    <div class="col-md-2">
      <div class="w-100 m-auto">
        <%= image_tag @post.user.avatar.url, class: "mw-100" if @post.user.avatar? %>
      </div>
      <h3 class="mx-auto mt-1 text-center"><%= @post.user.name %></h3>
      <div class="mt-3 w-100 post-show-add-friend">
        <% if current_user != @post.user %>
          <%= render partial: "shared/add_friend", locals: { user: @post.user } %>
        <% end %>
      </div>
    </div>
    <div class="offset-md-1 col-md-9 position-relative">
      <div class="mb-4" style="max-width: 500px; max-height: 400px;">
        <%= image_tag @post.photo.url, class: "mw-100" if @post.photo? %>
      </div>
      <div class="px-2">
        <p><%= @post.content %></p>
      </div>
    </div>
  </div>
  <div class="position-relative mt-4">
    <div class="post-edit">
      <% if @post.user == current_user %>
        <%= link_to edit_post_path(@post), class: "btn btn-light" do %>
          <%= icon("far", "edit") %>
        <% end %>
      <% end %>
      <% if @post.user == current_user || current_user.admin? %>
        <%= link_to post_path(@post), method: :delete,
        class: "btn btn-light", data: { confirm: "Are you sure?" } do %>
          <%= icon("fas", "times") %>
        <% end %>
      <% end %>
    </div>
  </div>
  <div style="height: 1px; clear: both;" class="bg-secondary my-5"></div>
</div>

<% @post.replies.each do |reply| %>
  <div class="row mb-3 mx-4">
    <div class="col-md-2">
      <div class="w-100 m-auto">
        <%= image_tag reply.user.avatar.url, class: "mw-100" if reply.user.avatar? %>
      </div>
      <h3 class="mx-auto mt-1 text-center"><%= reply.user.name %></h3>
      <div class="mt-3 w-100 post-show-add-friend">
        <% if current_user != reply.user %>
          <%= render partial: "shared/add_friend", locals: { user: reply.user } %>
        <% end %>
      </div>
    </div>
    <div class="offset-md-1 col-md-9">
      <div class="px-2">
        <p><%= reply.comment %></p>
      </div>
    </div>
  </div>
  <div class="position-relative">
    <div class="post-edit">
      <% if reply.user == current_user %>
        <%= link_to edit_post_reply_path(@post, reply), class: "btn btn-light" do %>
          <%= icon("far", "edit") %>
        <% end %>
        <%= link_to post_reply_path(@post, reply), method: :delete,
        class: "btn btn-light", data: { confirm: "Are you sure?" } do %>
          <%= icon("fas", "times") %>
        <% end %>
      <% end %>
    </div>
  </div>
  <div style="height: 1px; clear: both;" class="bg-secondary my-4"></div>
<% end %>

<div class="mt-5 mx-4">
  <%= form_for [@post, Reply.new] do |f| %>
    <div class="form-group" id="comment-area">
      <%= f.text_area :comment, placeholder: "Add comment", class: "form-control", rows: 5 %>
      <%= f.submit "Submit", class: "btn btn-primary float-right mt-3" %>
    </div>
  <% end %>
</div>
